	package personnages;

import java.util.Random;

public class Humain {
    private String nom;
    private String boissonFavorite;
    private int argent;

    protected Humain[] memoire;
    protected int nbConnaissances;

    public Humain(String nom, String boissonFavorite, int argent) {
        this.nom = nom;
        this.boissonFavorite = boissonFavorite;
        this.argent = argent;
        this.memoire = new Humain[30];
        this.nbConnaissances = 0;
    }

    public String getNom() {
        return nom;
    }

    protected void parler(String texte) {
        System.out.println("(" + nom + ") - " + texte);
    }

    public void direBonjour() {
        parler("Bonjour ! Je m’appelle " + nom + " et j’aime boire du " + boissonFavorite + ".");
    }

    public void boire() {
        parler("Mmmm, un bon verre de " + boissonFavorite + " ! GLOUPS !");
    }

    protected void gagnerArgent(int gain) {
        argent += gain;
    }

    protected void perdreArgent(int perte) {
        argent -= perte;
    }

    public void acheter(String bien, int prix) {
        if (argent >= prix) {
            parler("J'ai " + argent + " sous en poche. Je vais pouvoir m'offrir " + bien + " à " + prix + " sous");
            perdreArgent(prix);
        } else {
            parler("Je n'ai plus que " + argent + " sous en poche. Je ne peux même pas m'offrir " + bien + " à " + prix + " sous.");
        }
    }

    public void faireConnaissanceAvec(Humain autre) {
        this.direBonjour();
        autre.direBonjour();

        memoriser(autre);
        autre.memoriser(this);
    }

    protected void memoriser(Humain h) {
        if (nbConnaissances < memoire.length) {
            memoire[nbConnaissances++] = h;
        } else {
            // shift
            for (int i = 1; i < memoire.length; i++) {
                memoire[i - 1] = memoire[i];
            }
            memoire[memoire.length - 1] = h;
        }
    }

    public void listerConnaissances() {
        if (nbConnaissances == 0) {
            parler("Je ne connais encore personne.");
            return;
        }
        String texte = "Je connais beaucoup de monde dont : ";
        for (int i = 0; i < nbConnaissances; i++) {
            texte += memoire[i].getNom();
            if (i < nbConnaissances - 1) texte += ", ";
        }
        parler(texte);
    }
}



package personnages;

public class Commercant extends Humain {

    public Commercant(String nom, int argent) {
        super(nom, "thé", argent);
    }

    public int seFaireExtorquer() {
        int perdu = argent;
        argent = 0;
        parler("J’ai tout perdu! Le monde est trop injuste...");
        return perdu;
    }

    public void recevoir(int argent) {
        gagnerArgent(argent);
        parler(argent + " sous ! Je te remercie généreux donateur!");
    }
}

package personnages;

public class Yakuza extends Humain {

    private String clan;
    private int reputation = 0;

    public Yakuza(String nom, String boissonFavorite, int argent, String clan) {
        super(nom, boissonFavorite, argent);
        this.clan = clan;
    }

    @Override
    public void direBonjour() {
        super.direBonjour();
        parler("Mon clan est celui de " + clan + ".");
    }

    public void extorquer(Commercant victime) {
        parler("Tiens, tiens, ne serait-ce pas un faible marchand qui passe par là ?");
        parler(victime.getNom() + ", si tu tiens à la vie donne moi ta bourse !");
        int argentVole = victime.seFaireExtorquer();
        gagnerArgent(argentVole);
        reputation++;
        parler("J’ai piqué les " + argentVole + " sous de " + victime.getNom() +
               ", ce qui me fait " + argent + " sous dans ma poche. Hi ! Hi !");
    }

    public int perdre() {
        int perdu = argent;
        argent = 0;
        reputation--;
        parler("J’ai perdu mon duel et mes " + perdu +
               " sous, snif... J'ai déshonoré le clan de " + clan + ".");
        return perdu;
    }

    public void gagner(int gain) {
        gagnerArgent(gain);
        reputation++;
        parler("Ce ronin pensait vraiment me battre ? Je l'ai dépouillé de ses " + gain + " sous.");
    }

    public int getReputation() {
        return reputation;
    }
}



package personnages;

public class Ronin extends Humain {

    private int honneur = 1;

    public Ronin(String nom, String boisson, int argent) {
        super(nom, boisson, argent);
    }

    public void donner(Commercant beneficiaire) {
        int don = argent / 10;
        parler(beneficiaire.getNom() + " prend ces " + don + " sous.");
        perdreArgent(don);
        beneficiaire.recevoir(don);
    }

    public void provoquer(Yakuza adversaire) {
        parler("Je t'ai retrouvé vermine, tu vas payer pour ce que tu as fait à ce pauvre marchand!");
        int force = honneur * 2;
        if (force >= adversaire.getReputation()) {
            parler("Je t’ai eu petit yakusa!");
            int argentGagne = adversaire.perdre();
            gagnerArgent(argentGagne);
            honneur++;
        } else {
            parler("J'ai perdu contre ce yakuza, mon honneur et ma bourse ont en pris un coup.");
            adversaire.gagner(argent);
            argent = 0;
            honneur--;
        }
    }
}



package personnages;

public class Samourai extends Ronin {

    private String seigneur;

    public Samourai(String seigneur, String nom, String boisson, int argent) {
        super(nom, boisson, argent);
        this.seigneur = seigneur;
    }

    @Override
    public void direBonjour() {
        super.direBonjour();
        System.out.println("(" + getNom() + ") - Je suis fier de servir le seigneur " + seigneur + ".");
    }

    public void boire(String boisson) {
        System.out.println("(" + getNom() + ") - Qu'est-ce que je vais choisir comme boisson ? Tiens je vais prendre du " + boisson + ".");
    }
}



package personnages;

import java.util.Random;

public class Traitre extends Samourai {

    private int niveauTraitrise = 0;
    private Random random = new Random();

    public Traitre(String seigneur, String nom, String boisson, int argent) {
        super(seigneur, nom, boisson, argent);
    }

    @Override
    public void direBonjour() {
        super.direBonjour();
        System.out.println("(" + getNom() + ") - Mais je suis un traître et mon niveau de traîtrise est : " + niveauTraitrise + ". Chut !");
    }

    public void ranconner(Commercant commercant) {
        if (niveauTraitrise >= 3) {
            System.out.println("(" + getNom() + ") - Mince je ne peux plus rançonner personne sinon un samouraï risque de me démasquer !");
            return;
        }

        int montant = commercant.argent / 5;
        System.out.println("(" + getNom() + ") - Si tu veux ma protection contre les Yakuzas, il va falloir payer !");
        System.out.println("Donne-moi " + montant + " sous ou gare à toi !");
        commercant.perdreArgent(montant);
        gagnerArgent(montant);
        niveauTraitrise++;
    }

    public void faireLeGentil() {
        if (nbConnaissances == 0) {
            System.out.println("(" + getNom() + ") - Je ne peux faire ami ami avec personne car je ne connais personne ! Snif.");
            return;
        }

        Humain ami = memoire[random.nextInt(nbConnaissances)];
        int don = argent / 20;

        System.out.println("(" + getNom() + ") - Il faut absolument remonter ma cote de confiance. Je vais faire ami ami avec " + ami.getNom() + ".");
        System.out.println("(" + getNom() + ") - Bonjour l'ami ! Je voudrais vous aider en vous donnant " + don + " sous.");
        ami.gagnerArgent(don);

        if (niveauTraitrise > 0) niveauTraitrise--;
    }
}package personnages;

import java.util.Random;

public class GrandMere extends Humain {

    private Random random = new Random();

    private enum TypeHumain {
        Commercant,
        Ronin,
        Yakuza,
        Samourai,
        Traitre,
        GrandMere,
        habitant
    }

    public GrandMere(String nom, int argent) {
        super(nom, "tisane", argent);
        this.memoire = new Humain[5];
    }

    @Override
    protected void memoriser(Humain h) {
        if (nbConnaissances >= memoire.length) {
            parler("Oh ma tête ! Je ne peux plus retenir le nom d'une personne supplémentaire !");
            return;
        }
        memoire[nbConnaissances++] = h;
    }

    private String humainHasard() {
        TypeHumain[] types = TypeHumain.values();
        return types[random.nextInt(types.length)].toString();
    }

    public void ragoter() {
        for (int i = 0; i < nbConnaissances; i++) {
            Humain h = memoire[i];

            if (h instanceof Traitre) {
                parler("Je sais que " + h.getNom() + " est un traître. Petit chenapan !");
            } else {
                parler("Je crois que " + h.getNom() + " est un " + humainHasard());
            }
        }
    }
}



package histoire;

import personnages.*;

public class HistoireTP4 {
    public static void main(String[] args) {

        Humain prof = new Humain("Prof", "kombucha", 54);
        prof.direBonjour();
        prof.acheter("boisson", 12);
        prof.boire();
        prof.acheter("jeu", 2);
        prof.acheter("kimono", 50);

        Commercant marco = new Commercant("Marco", 20);
        marco.direBonjour();
        marco.seFaireExtorquer();
        marco.recevoir(15);
        marco.boire();

        Yakuza yaku = new Yakuza("Yaku Le Noir", "whisky", 30, "Warsong");
        yaku.direBonjour();
        yaku.extorquer(marco);

        Ronin roro = new Ronin("Roro", "shochu", 60);
        roro.direBonjour();
        roro.donner(marco);

        roro.provoquer(yaku);
    }
}



package histoire;

import personnages.*;

public class HistoireTP5 {
    public static void main(String[] args) {

        Commercant marco = new Commercant("Marco", 20);
        Commercant chonin = new Commercant("Chonin", 40);
        Commercant kumi = new Commercant("Kumi", 10);
        Yakuza yaku = new Yakuza("Yaku Le Noir", "whisky", 30, "Warsong");
        Ronin roro = new Ronin("Roro", "shochu", 60);

        marco.faireConnaissanceAvec(roro);
        marco.faireConnaissanceAvec(yaku);
        marco.faireConnaissanceAvec(chonin);
        marco.faireConnaissanceAvec(kumi);

        marco.listerConnaissances();
        roro.listerConnaissances();
        yaku.listerConnaissances();

        Samourai akimoto = new Samourai("Miyamoto", "Akimoto", "saké", 80);
        akimoto.direBonjour();
        akimoto.listerConnaissances();

        Traitre masako = new Traitre("Miyamoto", "Masako", "whisky", 100);

        GrandMere grandMere = new GrandMere("Grand-Mère", 10);
        grandMere.faireConnaissanceAvec(akimoto);
        grandMere.faireConnaissanceAvec(yaku);
        grandMere.faireConnaissanceAvec(masako);
        grandMere.faireConnaissanceAvec(kumi);
        grandMere.faireConnaissanceAvec(marco);
        grandMere.faireConnaissanceAvec(chonin);
        grandMere.ragoter();
    }
}
